<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Locality</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar for chat messages */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Inter Font */
        body {
            font-family: "Inter", sans-serif;
            overflow-y: scroll; /* Allow body to scroll */
        }

        /* Ensure main content area expands and scrolls independently */
        #app-content {
            min-height: calc(100vh - 120px - 80px); /* Adjust height to fill space above footer and below header */
        }

        /* Custom styling for header title for 'wow factor' */
        #header-title {
            font-size: 1.75rem; /* Larger font size */
            font-weight: 800; /* Extra bold */
            letter-spacing: -0.05em; /* Tighter letter spacing */
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); /* Subtle text shadow */
            background: linear-gradient(45deg, #FFD700, #FFA500); /* Gold to Orange gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: transparent; /* Fallback for non-webkit browsers */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col font-sans relative pb-20 sm:pb-24">

    <!-- Header (Top Bar) -->
    <header id="app-header" class="sticky top-0 z-10 w-full bg-gradient-to-r from-purple-700 to-indigo-800 text-white p-4 shadow-lg flex items-center justify-between rounded-b-xl">
        <div class="flex items-center">
            <button id="back-button" class="p-2 mr-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white hidden">
                <!-- Lucide ArrowLeft Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
            </button>
            <!-- Logo and App Name -->
            <div class="flex items-center">
                <!-- Placeholder Logo SVG (e.g., a stylized 'L' or pin icon) -->
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin-off mr-2 text-yellow-300">
                    <path d="M11.69 11.69a2 2 0 1 0 1.62 1.62"/><path d="M12 21.75V22"/><path d="M12 2a8 8 0 0 0-7.92 7.92A7 7 0 0 0 4 10c0 7.2 9 12 9 12s2.07-1.39 3.5-2.82"/><path d="m2 2 20 20"/></svg>
                <h1 id="header-title" class="font-inter">Locality</h1>
            </div>
        </div>
        <div class="flex items-center space-x-3">
            <button class="p-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white">
                <!-- Lucide Search Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </button>
            <button class="p-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white">
                <!-- Lucide Bell Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bell"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.36 14.16a3.5 3.5 0 0 0 3.28 0"/></svg>
            </button>
            <!-- Home button in the header -->
            <button id="home-button-header" class="p-2 rounded-full hover:bg-white/20 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-white">
                <!-- Lucide Home Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-content" class="flex-1 overflow-y-auto pt-4 pb-4">
        <!-- Content will be rendered here by JavaScript -->
    </main>

    <!-- Navigation Bar (Bottom Bar) -->
    <nav class="fixed bottom-0 z-20 w-full bg-white border-t border-gray-200 shadow-xl flex justify-around py-2 rounded-t-xl">
        <button id="nav-home" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-purple-700 font-semibold">
            <!-- Lucide Home Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-home mb-1"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            <span class="text-xs font-inter">Home</span>
        </button>
        <button id="nav-categories" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide LayoutGrid Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid mb-1"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
            <span class="text-xs font-inter">Categories</span>
        </button>
        <button id="nav-sell" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide Plus Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus mb-1"><path d="M12 5v14"/><path d="M5 12h14"/></svg>
            <span class="text-xs font-inter">Sell</span>
        </button>
        <button id="nav-chat" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide MessageCircle Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle mb-1"><path d="M7.9 20A9.9 9.9 0 1 0 4 16.1L2 22Z"/></svg>
            <span class="text-xs font-inter">Chat</span>
        </button>
        <button id="nav-profile" class="flex flex-col items-center p-2 rounded-lg transition-colors duration-200 text-gray-500 hover:text-purple-600">
            <!-- Lucide User Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user mb-1"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            <span class="text-xs font-inter">Profile</span>
        </button>
    </nav>

    <!-- Firebase JS SDKs (removed, but keeping the script tag for organization) -->
    <script type="module">
        // NO FIREBASE IMPORTS IN THIS MOCKUP VERSION

        // --- Mock Data ---
        const mockProducts = [
            {
                id: 'p1',
                name: 'Custom Tailoring Services',
                category: 'Services',
                description: 'Expert tailoring for all your clothing needs â€“ repairs, alterations, and custom designs. Perfect fit guaranteed!',
                price: 80.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/tailor.jpg',
                location: 'Central Market Area',
                deliveryOptions: 'Pickup Only',
                hours: 'Mon-Sat: 10 AM - 7 PM',
                shopStatus: 'N/A' // Not applicable for services
            },
            {
                id: 'p2',
                name: 'Homemade Spicy Kerepek',
                category: 'Food & Drink',
                description: 'Crispy and delicious homemade kerepek with a spicy kick! Perfect snack for any time.',
                price: 15.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/kerepek.jpg',
                location: 'Taman Bahagia',
                deliveryOptions: 'Both Pickup & Delivery',
                hours: 'Daily: 1 PM - 9 PM',
                shopStatus: 'Open'
            },
            {
                id: 'p3',
                name: 'Vintage Leather Handbag',
                category: 'Fashion',
                description: 'A classic vintage leather handbag, well-maintained and stylish. A timeless accessory.',
                price: 120.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/images.jpg',
                location: 'Bandar Sunway',
                deliveryOptions: 'Delivery Available',
                hours: 'N/A',
                shopStatus: 'N/A'
            },
            {
                id: 'p4',
                name: 'Gaming PC (Used)',
                category: 'Electronics',
                description: 'High-performance gaming PC, recently upgraded. Runs all modern games smoothly.',
                price: 2500.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download.jpg',
                location: 'Cyberjaya',
                deliveryOptions: 'Pickup Only',
                hours: 'N/A',
                shopStatus: 'N/A'
            },
            {
                id: 'p5',
                name: 'Hand-knitted Baby Blanket',
                category: 'Babies & Kids',
                description: 'Soft and warm hand-knitted blanket, ideal for newborns and toddlers. Hypoallergenic yarn.',
                price: 45.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(1).jpg',
                location: 'Wangsa Maju',
                deliveryOptions: 'Delivery Available',
                hours: 'N/A',
                shopStatus: 'N/A'
            },
            {
                id: 'p6',
                name: 'Organic Honey (Local)',
                category: 'Food & Drink',
                description: 'Pure, raw, and organic honey sourced from local farms. Great for health and taste.',
                price: 35.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(2).jpg',
                location: 'Ampang',
                deliveryOptions: 'Both Pickup & Delivery',
                hours: 'Mon-Fri: 9 AM - 5 PM',
                shopStatus: 'Closing Soon'
            },
            {
                id: 'p7',
                name: 'Personal Fitness Coaching',
                category: 'Services',
                description: 'Certified personal trainer offering one-on-one fitness coaching sessions. Achieve your health goals!',
                price: 200.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(3).jpg',
                location: 'Mont Kiara',
                deliveryOptions: 'N/A',
                hours: 'By appointment',
                shopStatus: 'N/A'
            },
            {
                id: 'p8',
                name: 'Vintage Wooden Chair',
                category: 'Home Goods',
                description: 'Beautifully crafted vintage wooden chair, perfect as a decorative piece or for daily use. Solid build.',
                price: 90.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(4).jpg',
                location: 'Petaling Jaya',
                deliveryOptions: 'Pickup Only',
                hours: 'N/A',
                shopStatus: 'N/A'
            },
            {
                id: 'job1',
                name: 'Part-time Barista Needed',
                category: 'Jobs',
                description: 'Local cafe seeking enthusiastic part-time barista. Experience preferred but not required.',
                price: 'Negotiable', // Price for jobs can be text
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(5).jpg',
                location: 'Damansara Utama',
                deliveryOptions: 'N/A',
                hours: 'Flexible',
                shopStatus: 'Open'
            },
            {
                id: 'job2',
                name: 'Freelance Web Developer',
                category: 'Jobs',
                description: 'Looking for a freelance web developer for a small business website project. React experience a plus.',
                price: 'Project-based',
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(1).png',
                location: 'Remote (KL-based preferred)',
                deliveryOptions: 'N/A',
                hours: 'Flexible',
                shopStatus: 'Open'
            },
            {
                id: 'p9',
                name: 'Pre-loved Children\'s Books',
                category: 'Babies & Kids',
                description: 'A collection of gently used children\'s storybooks for various age groups. Great for early readers!',
                price: 25.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(6).jpg',
                location: 'Subang Jaya',
                deliveryOptions: 'Pickup Only',
                hours: 'N/A',
                shopStatus: 'N/A'
            },
            {
                id: 'p10',
                name: 'Used Mountain Bike',
                category: 'Vehicles',
                description: 'Well-maintained mountain bike, perfect for trail riding. Shimano gears, disc brakes.',
                price: 850.00,
                imageUrl: 'https://uploads.onecompiler.io/43ky4y72u/43pggk8vt/download%20(7).jpg',
                location: 'Shah Alam',
                deliveryOptions: 'Pickup Only',
                hours: 'N/A',
                shopStatus: 'N/A'
            }
        ];

        const allCategories = [
            'All',
            'Services',
            'Food & Drink',
            'Fashion',
            'Electronics',
            'Home Goods',
            'Babies & Kids',
            'Vehicles',
            'Real Estate',
            'Jobs',
            'Pets'
        ];

        const mockChatRooms = [
            {
                id: 'general_community',
                name: 'General Community Chat',
                description: 'A place for all community members to connect.',
                type: 'public',
                createdAt: new Date().toISOString()
            },
            {
                id: 'mothers_sanctuary',
                name: "Mothers' Sanctuary",
                description: 'A supportive space exclusively for mothers.',
                type: 'mothers',
                createdAt: new Date().toISOString()
            },
            {
                id: 'local_foodies',
                name: "Local Foodies",
                description: 'Share your favorite local eats and recipes!',
                type: 'public',
                createdAt: new Date().toISOString()
            }
        ];

        // Mock messages for each room (static, for display only)
        const mockMessages = {
            'general_community': [
                { senderId: 'user123', text: 'Hey everyone, anyone selling old books?', timestamp: Date.now() - 3600000 },
                { senderId: 'user456', text: 'I have a few! What genre are you looking for?', timestamp: Date.now() - 3500000 },
                { senderId: 'user123', text: 'Mostly fiction and fantasy.', timestamp: Date.now() - 3400000 },
            ],
            'mothers_sanctuary': [
                { senderId: 'mom_of_2', text: 'Hi moms! Any recommendations for baby-friendly cafes in PJ?', timestamp: Date.now() - 7200000 },
                { senderId: 'super_mom', text: 'The Little Muffin Cafe near Section 14 is great!', timestamp: Date.now() - 7100000 },
                { senderId: 'new_mama', text: 'Yes, I second Little Muffin! Their play area is a lifesaver.', timestamp: Date.now() - 7000000 },
                { senderId: 'mom_of_2', text: 'Thanks for the tips!', timestamp: Date.now() - 6900000 },
            ],
            'local_foodies': [
                { senderId: 'food_lover', text: 'Just tried the new nasi lemak stall. So good!', timestamp: Date.now() - 10800000 },
                { senderId: 'eater_pro', text: 'Where is it? Need to check it out!', timestamp: Date.now() - 10700000 },
                { senderId: 'food_lover', text: 'It\'s at the corner of Jalan SS2/7. Look for the red awning.', timestamp: Date.now() - 10600000 },
            ]
        };


        // --- App State (Vanilla JS equivalent) ---
        let currentPage = 'home'; // 'home', 'categories', 'sell', 'chat', 'profile', 'chatDetail', 'productDetail', 'myListings', 'editListing'
        let currentChatRoomId = null;
        let currentChatRoomName = '';
        let searchTerm = '';
        let selectedCategory = 'All';
        let selectedProduct = null; // For product detail view
        let editingListing = null; // Stores the listing object currently being edited
        const currentUserId = 'mock_user_123'; // A fixed user ID for the mockup

        let chatMessages = {}; // To store dynamic messages added in mockup
        let userListings = []; // New array to store user-added products

        const appContent = document.getElementById('app-content');
        const headerTitle = document.getElementById('header-title');
        const backButton = document.getElementById('back-button');
        const homeButtonHeader = document.getElementById('home-button-header');
        const navButtons = {
            home: document.getElementById('nav-home'),
            categories: document.getElementById('nav-categories'),
            sell: document.getElementById('nav-sell'),
            chat: document.getElementById('nav-chat'),
            profile: document.getElementById('nav-profile'),
        };

        // --- Navigation Functions ---
        const handleNavigate = (page) => {
            currentPage = page;
            // Clear specific states when navigating to a new main section
            if (page !== 'chatDetail') { // Keep chat detail if navigating within chat
                currentChatRoomId = null;
                currentChatRoomName = '';
            }
            if (page !== 'productDetail') { // Keep product detail if navigating from products
                selectedProduct = null;
            }
            if (page !== 'editListing') { // Clear editing listing if navigating away from edit page
                editingListing = null;
            }
            
            renderPage(currentPage);
            updateNavActiveState(currentPage);
        };

        const updateNavActiveState = (activePage) => {
            Object.keys(navButtons).forEach(key => {
                const button = navButtons[key];
                if (key === activePage) {
                    button.classList.add('text-purple-700', 'font-semibold');
                    button.classList.remove('text-gray-500', 'hover:text-purple-600');
                } else {
                    button.classList.remove('text-purple-700', 'font-semibold');
                    button.classList.add('text-gray-500', 'hover:text-purple-600');
                }
            });
        };

        const updateHeader = () => {
            const pageTitles = {
                home: 'Locality',
                categories: 'Categories',
                sell: 'Sell Item',
                chat: 'Community Chats',
                productDetail: selectedProduct ? selectedProduct.name : 'Product Details',
                profile: 'My Profile',
                myListings: 'My Listings',
                editListing: `Edit: ${editingListing ? editingListing.name : 'Listing'}`,
            };
            // For chatDetail, header title is dynamic, handled in renderChatRoomDetail
            if (currentPage !== 'chatDetail') {
                 headerTitle.textContent = pageTitles[currentPage];
            }
           

            if (currentPage !== 'home') {
                backButton.classList.remove('hidden');
            } else {
                backButton.classList.add('hidden');
            }
        };

        backButton.addEventListener('click', () => {
            if (currentPage === 'chatDetail') {
                handleNavigate('chat');
            } else if (currentPage === 'productDetail') {
                handleNavigate('home'); // Go back to home from product detail
            } else if (currentPage === 'editListing') {
                handleNavigate('myListings'); // Go back to my listings from edit page
            }
            else {
                handleNavigate('home'); // Fallback to home for other back actions
            }
        });

        homeButtonHeader.addEventListener('click', () => {
            handleNavigate('home');
        });

        // --- Page Rendering Functions ---

        const renderHomePage = () => {
            updateHeader();
            let html = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2 font-inter text-center">Locality</h2>
                    <p class="text-purple-700 text-md font-semibold mb-6 font-inter text-center">Shop Local. Work Local. Thrive Together.</p>

                    <!-- Location Search Input (Placeholder for future feature) -->
                    <div class="bg-white p-6 rounded-xl shadow-lg mb-6 flex items-center justify-between">
                        <div class="flex items-center">
                            <!-- Lucide MapPin Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin text-purple-600 mr-2"><path d="M12 17.5l-4-4H8a5 5 0 1 1 8 0h-4l4 4zM12 2a8 8 0 0 1 8 8c0 7.2-9 12-9 12S4 17.2 4 10a8 8 0 0 1 8-8z"/></svg>
                            <span class="font-semibold text-gray-800 font-inter">Location: <span class="font-normal text-gray-600">Your Area (Click to change)</span></span>
                        </div>
                        <button class="text-purple-600 hover:text-purple-800 transition-colors duration-200">
                            <!-- Lucide Search Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                        </button>
                    </div>

                    <!-- General Search Bar and Sort by Price -->
                    <div class="mb-6 flex flex-col sm:flex-row gap-4">
                        <input
                            type="text"
                            id="product-search-input"
                            value="${searchTerm}"
                            placeholder="Search products, services, jobs..."
                            class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-700 font-inter shadow-sm"
                        />
                        <select id="sort-price-select" class="p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-700 font-inter shadow-sm">
                            <option value="default">Sort by Price</option>
                            <option value="asc">Price: Low to High</option>
                            <option value="desc">Price: High to Low</option>
                        </select>
                    </div>

                    <!-- New: Local Job Openings Banner -->
                    <div class="bg-gradient-to-r from-teal-500 to-emerald-600 text-white p-6 rounded-xl shadow-lg mb-6 text-center animate-pulse-slow">
                        <h3 class="text-2xl font-bold font-inter mb-2">Local Job Openings!</h3>
                        <p class="text-lg font-inter">Find your next opportunity within the community.</p>
                        <button class="mt-4 bg-white text-emerald-700 font-bold py-2 px-6 rounded-full shadow-md hover:bg-gray-100 transition-colors duration-300 transform hover:scale-105">
                            Browse Jobs
                        </button>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                        <h3 class="text-xl font-semibold text-purple-700 mb-3 font-inter">Featured Listings</h3>
                        <div id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <!-- Products will be rendered here -->
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-semibold text-purple-700 mb-3 font-inter">Local Events</h3>
                        <p class="text-gray-500 font-inter">Check out upcoming community events near you!</p>
                        <img
                          src="https://placehold.co/300x100/d0d0d0/444444?text=Event+Banner"
                          alt="Event Banner"
                          class="w-full h-24 object-cover rounded-lg mt-4 shadow-md"
                          onerror="this.onerror=null;this.src='https://placehold.co/300x100/d0d0d0/444444?text=Image+Load+Error';"
                        />
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            // Add event listener for search input
            const searchInput = document.getElementById('product-search-input');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchTerm = e.target.value;
                    renderProductCards(getCombinedAndFilteredProducts()); // Re-render products with new search term
                });
            }

            // Add event listener for sort by price
            const sortPriceSelect = document.getElementById('sort-price-select');
            if (sortPriceSelect) {
                sortPriceSelect.addEventListener('change', (e) => {
                    const sortOrder = e.target.value;
                    renderProductCards(getCombinedAndFilteredProducts(sortOrder));
                });
            }

            // Event listener for "Browse Jobs" button
            const browseJobsButton = appContent.querySelector('.bg-white.text-emerald-700');
            if (browseJobsButton) {
                browseJobsButton.addEventListener('click', () => {
                    selectedCategory = 'Jobs'; // Set category to Jobs
                    handleNavigate('home'); // Navigate to home, which will filter by Jobs
                });
            }

            // Initial render of product cards
            renderProductCards(getCombinedAndFilteredProducts());
        };

        const renderProductCards = (productsToRender) => {
            const productListDiv = document.getElementById('product-list');
            if (!productListDiv) return;

            if (productsToRender.length === 0) {
                productListDiv.innerHTML = '<p class="text-gray-500 font-inter text-center col-span-full">No products found matching your criteria.</p>';
                return;
            }

            productListDiv.innerHTML = productsToRender.map(product => `
                <button
                    class="product-card block w-full bg-gray-50 rounded-xl shadow-md overflow-hidden transform hover:scale-[1.02] transition-transform duration-200 cursor-pointer text-left"
                    data-product-id="${product.id}"
                >
                    <img
                        src="${product.imageUrl}"
                        alt="${product.name}"
                        class="w-full h-40 object-cover"
                        onerror="this.onerror=null;this.src='https://placehold.co/300x200/e0e0e0/555555?text=Image+Error';"
                    />
                    <div class="p-4">
                        <h4 class="text-lg font-semibold text-gray-800 mb-1 font-inter">${product.name}</h4>
                        <p class="text-sm text-gray-600 mb-2 font-inter flex items-center">
                            <!-- Lucide Tag Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-1 text-purple-500"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414L12.586 22.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
                            ${product.category}
                        </p>
                        <p class="text-md font-bold text-purple-700 font-inter flex items-center">
                            <!-- Lucide Euro Icon (used as placeholder for MYR) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-euro mr-1"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 4.5-2"/></svg>
                            ${typeof product.price === 'number' ? `MYR ${product.price.toFixed(2)}` : product.price}
                        </p>
                        <p class="text-xs text-gray-500 mt-2 font-inter flex items-center">
                            <!-- Lucide MapPin Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-1"><path d="M12 17.5l-4-4H8a5 5 0 1 1 8 0h-4l4 4zM12 2a8 8 0 0 1 8 8c0 7.2-9 12-9 12S4 17.2 4 10a8 8 0 0 1 8-8z"/></svg>
                            ${product.location}
                        </p>
                    </div>
                </button>
            `).join('');

            // Add event listeners for each product card
            productListDiv.querySelectorAll('.product-card').forEach(card => {
                card.addEventListener('click', () => {
                    const productId = card.dataset.productId;
                    // Find in combined list
                    const product = getCombinedProducts().find(p => p.id === productId);
                    if (product) {
                        selectedProduct = product;
                        handleNavigate('productDetail');
                    }
                });
            });
        };

        const getCombinedProducts = () => {
            return [...mockProducts, ...userListings];
        };

        const getCombinedAndFilteredProducts = (sortOrder = 'default') => {
            let allProducts = getCombinedProducts();
            
            // Filter by search term
            allProducts = allProducts.filter(product => {
                const matchesSearch = searchTerm.toLowerCase() === '' ||
                                      product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                                      product.description.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesCategory = selectedCategory === 'All' || product.category === selectedCategory;
                return matchesSearch && matchesCategory;
            });

            // Sort by price if applicable
            if (sortOrder !== 'default') {
                allProducts.sort((a, b) => {
                    const priceA = typeof a.price === 'number' ? a.price : Infinity; // Treat non-numeric prices as very high for sorting
                    const priceB = typeof b.price === 'number' ? b.price : Infinity;

                    if (sortOrder === 'asc') {
                        return priceA - priceB;
                    } else { // desc
                        return priceB - priceA;
                    }
                });
            }

            return allProducts;
        };


        const renderCategoriesPage = () => {
            updateHeader();
            // Map of category names to Lucide icon SVG strings
            const categoryIcons = {
                'All': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-grid text-purple-500 mb-2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>`,
                'Services': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-wrench text-blue-500 mb-2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.19 2.19 0 0 1-3.15-3.15l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.77 3.77Z"/><path d="M19.5 12.5 16 16"/></svg>`,
                'Food & Drink': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-coffee text-orange-500 mb-2"><path d="M10 2v6h3a4 4 0 0 1 4 4v1a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-3V2H5a2 2 0 0 0-2 2v6h.5"/><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/></svg>`,
                'Fashion': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-t-shirt text-pink-500 mb-2"><path d="M20.5 12.5V18a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V12.5L10 2h4l7.5 10.5z"/><path d="M4 12h16"/></svg>`,
                'Electronics': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-laptop text-indigo-500 mb-2"><path d="M20 16V7a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v9m16 0H4m16 0 1.28 2.55a1 1 0 0 1-.91 1.45H3.63a1 1 0 0 1-.91-1.45L4 16m0 0h16"/></svg>`,
                'Home Goods': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sofa text-amber-600 mb-2"><path d="M12.9 7.8A2 2 0 0 0 11 9H9a2 2 0 0 0-2 2v1h10v-1a2 2 0 0 0-2-2h-1.9z"/><path d="M2 12v3a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2z"/><path d="M2 17v2a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-2"/></svg>`,
                'Babies & Kids': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-baby text-purple-400 mb-2"><path d="M9 12v-2a3 3 0 0 1 6 0v2"/><path d="M12 2a5 5 0 0 0-5 5v3a3 3 0 0 0 3 3h4a3 3 0 0 0 3-3V7a5 5 0 0 0-5-5z"/><path d="M12 13v9"/><path d="M7 18h10"/></svg>`,
                'Vehicles': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-car text-red-500 mb-2"><path d="M19 17H5a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2Z"/><circle cx="7" cy="12" r="2"/><circle cx="17" cy="12" r="2"/></svg>`,
                'Real Estate': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-building text-green-600 mb-2"><rect width="16" height="18" x="4" y="3" rx="2" ry="2"/><path d="M9 21v-3m6 3v-3m-9-3h12"/></svg>`,
                'Jobs': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-briefcase text-emerald-600 mb-2"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>`,
                'Pets': `<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-paw-print text-brown-500 mb-2"><path d="M5.5 10.2c-.9 0-1.7.2-2.5.6V12l.6 1.2c.5 1 1.4 1.8 2.5 2.2L7 16l-1 2c-1.4 2.8-2.1 4.2-2.1 4.2s1.7-.6 3.2-2c1.5-1.4 2.6-3.8 3.3-5.5L12 12l1.6 1.6c.8 1.5 1.5 2.5 2.6 3.5 1.1 1 2.4 1.7 3.5 1.9 1.1.2 2.2-.2 2.2-.2s-1.4-1.3-2.5-3.5c-1.1-2.2-1.9-4.5-2.5-5.5L17 12l-1.5-1.5c-.8-.8-1.7-1.3-2.5-1.5-.8-.2-1.6-.1-2.5 0-.9.1-1.7.4-2.5.8L7 10.5V10.2z"/></svg>`
            };

            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Browse Categories</h2>
                    <p class="text-gray-600 mb-6 font-inter">Find exactly what you're looking for!</p>
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                        ${allCategories.map(category => `
                            <button
                                class="category-button bg-white p-4 rounded-xl shadow-md flex flex-col items-center justify-center text-center hover:bg-purple-50 transition-colors duration-200 cursor-pointer ${category === 'Jobs' ? 'border-2 border-emerald-500' : ''}"
                                data-category="${category}"
                            >
                                ${categoryIcons[category] || categoryIcons['All']} <!-- Use specific icon or fallback to 'All' -->
                                <span class="font-inter text-gray-700 text-sm">${category}</span>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            appContent.querySelectorAll('.category-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    selectedCategory = e.currentTarget.dataset.category;
                    searchTerm = ''; // Clear search term when category is selected
                    handleNavigate('home');
                });
            });
        };

        const renderProductDetailPage = () => {
            updateHeader();
            if (!selectedProduct) {
                appContent.innerHTML = `<div class="text-center text-gray-500 p-8 font-inter">Product not found.</div>`;
                return;
            }

            // Determine if the product is in a 'Food & Drink' category
            const isFoodItem = selectedProduct.category === 'Food & Drink';

            // Determine shop status styling
            let shopStatusColorClass = '';
            let shopStatusIcon = '';
            if (isFoodItem && selectedProduct.shopStatus) {
                switch (selectedProduct.shopStatus) {
                    case 'Open':
                        shopStatusColorClass = 'text-green-600';
                        shopStatusIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-check-big mr-2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>`;
                        break;
                    case 'Closed':
                        shopStatusColorClass = 'text-red-600';
                        shopStatusIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-x mr-2"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>`;
                        break;
                    case 'Closing Soon':
                        shopStatusColorClass = 'text-orange-600';
                        shopStatusIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-alert-triangle mr-2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>`;
                        break;
                    default:
                        shopStatusColorClass = 'text-gray-600';
                        shopStatusIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mr-2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>`;
                        break;
                }
            }


            let html = `
                <div class="p-4">
                    <div class="bg-white p-6 rounded-xl shadow-lg max-w-lg mx-auto">
                        <img
                            src="${selectedProduct.imageUrl}"
                            alt="${selectedProduct.name}"
                            class="w-full h-64 object-cover rounded-lg mb-4 shadow-md"
                            onerror="this.onerror=null;this.src='https://placehold.co/400x300/e0e0e0/555555?text=Image+Error';"
                        />
                        <h2 class="text-3xl font-bold text-gray-900 mb-2 font-inter">${selectedProduct.name}</h2>
                        <p class="text-xl font-bold text-purple-700 mb-4 font-inter flex items-center">
                            <!-- Lucide Euro Icon (used as placeholder for MYR) -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-euro mr-1"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 4.5-2"/></svg>
                            ${typeof selectedProduct.price === 'number' ? `MYR ${selectedProduct.price.toFixed(2)}` : selectedProduct.price}
                        </p>
                        <p class="text-gray-700 mb-4 font-inter">${selectedProduct.description}</p>
                        <div class="flex items-center text-gray-600 mb-2 font-inter">
                            <!-- Lucide Tag Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-2 text-purple-500"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414L12.586 22.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
                            Category: <span class="font-semibold ml-1">${selectedProduct.category}</span>
                        </div>
                        <div class="flex items-center text-gray-600 mb-4 font-inter">
                            <!-- Lucide MapPin Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-map-pin mr-2 text-purple-500"><path d="M12 17.5l-4-4H8a5 5 0 1 1 8 0h-4l4 4zM12 2a8 8 0 0 1 8 8c0 7.2-9 12-9 12S4 17.2 4 10a8 8 0 0 1 8-8z"/></svg>
                            Location: <span class="font-semibold ml-1">${selectedProduct.location}</span>
                        </div>
                        ${selectedProduct.deliveryOptions && !isFoodItem ? `
                        <div class="flex items-center text-gray-600 mb-4 font-inter">
                            <!-- Lucide Truck Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-truck mr-2 text-purple-500"><path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/><path d="M10 18h6a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2h-6"/><path d="M2 18h10"/><path d="M18 13h4v2h-4"/><circle cx="7" cy="18" r="2"/><circle cx="17" cy="18" r="2"/></svg>
                            Delivery Options: <span class="font-semibold ml-1">${selectedProduct.deliveryOptions}</span>
                        </div>` : ''}
                        ${selectedProduct.hours ? `
                        <div class="flex items-center text-gray-600 mb-4 font-inter">
                            <!-- Lucide Clock Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock mr-2 text-purple-500"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            Hours: <span class="font-semibold ml-1">${selectedProduct.hours}</span>
                        </div>` : ''}
                        
                        <!-- New: Shop Status for Food & Drink only -->
                        ${isFoodItem && selectedProduct.shopStatus && selectedProduct.shopStatus !== 'N/A' ? `
                        <div class="flex items-center mb-4 font-inter ${shopStatusColorClass}">
                            ${shopStatusIcon}
                            Shop Status: <span class="font-semibold ml-1">${selectedProduct.shopStatus}</span>
                        </div>
                        ` : ''}

                        <!-- Conditional Buttons based on category -->
                        ${isFoodItem ? `
                            <div class="flex space-x-4 mt-4">
                                ${selectedProduct.deliveryOptions.includes('Pickup') || selectedProduct.deliveryOptions === 'Both Pickup & Delivery' ? `
                                <button class="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 font-inter transition-all duration-200 transform hover:scale-105 flex items-center justify-center">
                                    <!-- Lucide PackageIcon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-package mr-2"><path d="m7.5 4.27 9 5.15"/><path d="m7.5 19.73 9-5.15"/><path d="M3.3 8.7L12 3l8.7 5.7"/><path d="M12 22v-8.5"/><path d="M22 8.7V19L12 13 2 19V8.7l10-6.4Z"/></svg>
                                    Pickup
                                </button>
                                ` : ''}
                                ${selectedProduct.deliveryOptions.includes('Delivery') || selectedProduct.deliveryOptions === 'Both Pickup & Delivery' ? `
                                <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 font-inter transition-all duration-200 transform hover:scale-105 flex items-center justify-center">
                                    <!-- Lucide Bike Icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bike mr-2"><circle cx="18.5" cy="17.5" r="3.5"/><circle cx="5.5" cy="17.5" r="3.5"/><path d="M12 17.5V14l-3-3 4-3 2 3h2"/></svg>
                                    Delivery
                                </button>
                                ` : ''}
                            </div>
                        ` : `
                            <button class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 transform hover:scale-105 flex items-center justify-center">
                                <!-- Lucide ShoppingCart Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart mr-2"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>
                                Message Seller
                            </button>
                        `}
                    </div>
                </div>
            `;
            appContent.innerHTML = html;
        };


        const renderSellPage = () => {
            updateHeader();
            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Sell Your Item</h2>
                    <p class="text-gray-600 mb-6 font-inter">Turn your unused items into cash!</p>
                    <div class="bg-white p-6 rounded-xl shadow-lg max-w-md mx-auto">
                        <div class="mb-4">
                            <label for="sell-title" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Title</label>
                            <input type="text" id="sell-title" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., Vintage Lamp" />
                        </div>
                        <div class="mb-4">
                            <label for="sell-description" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Description</label>
                            <textarea id="sell-description" rows="3" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="Describe your item..."></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="sell-category" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Category</label>
                            <select id="sell-category" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">
                                ${allCategories.filter(cat => cat !== 'All').map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="sell-price" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Price (MYR)</label>
                            <input type="number" id="sell-price" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., 50.00" />
                        </div>
                        <div class="mb-4">
                            <label for="sell-image-url" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Image URL (Optional)</label>
                            <input type="text" id="sell-image-url" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., https://placehold.co/300x200" />
                        </div>
                        <div class="mb-4">
                            <label for="sell-location" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Location</label>
                            <input type="text" id="sell-location" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., Petaling Jaya" />
                        </div>
                        <!-- New: Pickup/Delivery Options -->
                        <div class="mb-4">
                            <label for="sell-delivery-options" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Pickup/Delivery Options</label>
                            <select id="sell-delivery-options" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="N/A">N/A</option>
                                <option value="Pickup Only">Pickup Only</option>
                                <option value="Delivery Available">Delivery Available</option>
                                <option value="Both Pickup & Delivery">Both Pickup & Delivery</option>
                            </select>
                        </div>
                        <!-- New: Operating Hours -->
                        <div class="mb-4">
                            <label for="sell-hours" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Operating Hours (e.g., Mon-Fri: 9 AM - 5 PM)</label>
                            <input type="text" id="sell-hours" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" placeholder="e.g., Daily: 9 AM - 6 PM" />
                        </div>
                        <!-- New: Shop Status (visible for all categories, but only applicable for Food & Drink mockups) -->
                        <div class="mb-6">
                            <label for="sell-shop-status" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Shop Status</label>
                            <select id="sell-shop-status" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="N/A">N/A</option>
                                <option value="Open">Open</option>
                                <option value="Closed">Closed</option>
                                <option value="Closing Soon">Closing Soon</option>
                            </select>
                        </div>
                        <button id="list-item-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 transform hover:scale-105">
                            List Item
                        </button>
                        <p id="sell-message" class="text-green-600 text-sm mt-3 hidden"></p>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            const listItemButton = document.getElementById('list-item-button');
            const sellMessage = document.getElementById('sell-message');

            if (listItemButton) {
                listItemButton.addEventListener('click', () => {
                    const title = document.getElementById('sell-title').value;
                    const description = document.getElementById('sell-description').value;
                    const category = document.getElementById('sell-category').value;
                    const priceInput = document.getElementById('sell-price').value;
                    const price = category === 'Jobs' ? priceInput : parseFloat(priceInput); // Handle price as string for jobs
                    const imageUrl = document.getElementById('sell-image-url').value;
                    const location = document.getElementById('sell-location').value;
                    const deliveryOptions = document.getElementById('sell-delivery-options').value;
                    const hours = document.getElementById('sell-hours').value;
                    const shopStatus = document.getElementById('sell-shop-status').value; // New field

                    // Basic validation for non-job categories requiring numeric price
                    if (category !== 'Jobs' && isNaN(price)) {
                        sellMessage.textContent = 'Please enter a valid numeric price for this category.';
                        sellMessage.classList.remove('hidden', 'text-green-600');
                        sellMessage.classList.add('text-red-600');
                        return;
                    }

                    if (title && description && category && location) {
                        // Generate a unique ID for new listings using timestamp + random suffix
                        const newId = `user_${Date.now()}_${Math.random().toString(36).substring(2, 8)}`;
                        const newListing = {
                            id: newId,
                            name: title,
                            description: description,
                            category: category,
                            price: price,
                            imageUrl: imageUrl || `https://placehold.co/300x200/cccccc/333333?text=${encodeURIComponent(title.substring(0,10))}`,
                            location: location,
                            deliveryOptions: deliveryOptions,
                            hours: hours,
                            shopStatus: shopStatus // Add to new listing
                        };
                        userListings.push(newListing);
                        sellMessage.textContent = 'Item listed successfully!';
                        sellMessage.classList.remove('hidden', 'text-red-600');
                        sellMessage.classList.add('text-green-600');

                        // Clear form fields
                        document.getElementById('sell-title').value = '';
                        document.getElementById('sell-description').value = '';
                        document.getElementById('sell-category').value = allCategories.filter(cat => cat !== 'All')[0];
                        document.getElementById('sell-price').value = '';
                        document.getElementById('sell-image-url').value = '';
                        document.getElementById('sell-location').value = '';
                        document.getElementById('sell-delivery-options').value = 'N/A';
                        document.getElementById('sell-hours').value = '';
                        document.getElementById('sell-shop-status').value = 'N/A'; // Reset shop status

                        // Optionally, navigate back to home after a short delay
                        setTimeout(() => {
                            handleNavigate('home');
                        }, 1500);

                    } else {
                        sellMessage.textContent = 'Please fill in all required fields (Title, Description, Category, Price, Location).';
                        sellMessage.classList.remove('hidden', 'text-green-600');
                        sellMessage.classList.add('text-red-600');
                    }
                });
            }
        };

        const renderChatRoomsPage = () => {
            updateHeader();
            let html = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter text-center">Community Chat Rooms</h2>
                    <p class="text-gray-600 mb-6 font-inter text-center">Join discussions and connect with neighbors!</p>
                    <div id="chat-rooms-list" class="space-y-4">
                        <!-- Chat rooms will be rendered here -->
                    </div>
                    <p class="text-xs text-gray-500 text-center mt-6 font-inter">Your User ID: <span class="font-mono text-purple-700 break-all">${currentUserId}</span></p>
                </div>
            `;
            appContent.innerHTML = html;

            // Render mock chat rooms
            const chatRoomsListDiv = document.getElementById('chat-rooms-list');
            if (chatRoomsListDiv) {
                if (mockChatRooms.length === 0) {
                    chatRoomsListDiv.innerHTML = '<div class="bg-white p-6 rounded-xl shadow-md text-center text-gray-500 font-inter">No chat rooms available.</div>';
                } else {
                    chatRoomsListDiv.innerHTML = mockChatRooms.map(room => `
                        <button
                            class="chat-room-button block w-full text-left bg-white p-5 rounded-xl shadow-md hover:bg-purple-50 transition-colors duration-200 cursor-pointer group"
                            data-room-id="${room.id}"
                            data-room-name="${room.name}"
                        >
                            <div class="flex items-center mb-2">
                                <!-- Lucide MessageCircle Icon -->
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle text-purple-600 group-hover:text-purple-700 mr-3"><path d="M7.9 20A9.9 9.9 0 1 0 4 16.1L2 22Z"/></svg>
                                <h3 class="text-lg font-semibold text-gray-800 font-inter group-hover:text-purple-800">${room.name}</h3>
                            </div>
                            <p class="text-gray-500 text-sm font-inter">${room.description}</p>
                            ${room.type === 'mothers' ? `
                                <span class="mt-2 inline-block bg-pink-100 text-pink-700 text-xs font-semibold px-2.5 py-0.5 rounded-full font-inter">
                                    <!-- Lucide Megaphone Icon -->
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-megaphone inline-block mr-1"><path d="m3 11 18-2L13 22 3 11z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/><path d="M11.6 16.8c1.3-1 2.3-2.3 3-3.6"/><path d="M3 11h3"/></svg>
                                    Mothers Only
                                </span>
                            ` : ''}
                        </button>
                    `).join('');

                    chatRoomsListDiv.querySelectorAll('.chat-room-button').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const roomId = e.currentTarget.dataset.roomId;
                            const roomName = e.currentTarget.dataset.roomName;
                            currentChatRoomId = roomId;
                            currentChatRoomName = roomName;
                            handleNavigate('chatDetail');
                        });
                    });
                }
            }
        };

        const renderChatRoomDetail = () => {
            updateHeader(); // Update header first
            let html = `
                <div class="flex flex-col h-[calc(100vh-120px)] sm:h-[calc(100vh-130px)] bg-gray-50 rounded-xl shadow-inner mx-auto max-w-screen-md">
                    <!-- Messages display area -->
                    <div id="messages-display-area" class="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                        <!-- Messages will be rendered here -->
                    </div>

                    <!-- Message input area -->
                    <div class="p-4 bg-white border-t border-gray-200 flex items-center rounded-b-xl">
                        <input
                            type="text"
                            id="new-message-input"
                            value=""
                            placeholder="Message in ${currentChatRoomName}..."
                            class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-700 font-inter"
                        />
                        <button id="send-message-button" class="ml-3 bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-full shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors duration-200">
                            <!-- Lucide ArrowUp Icon -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-up"><path d="M12 19V5"/><path d="m5 12 7-7 7 7"/></svg>
                        </button>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            const messageInput = document.getElementById('new-message-input');
            const sendMessageButton = document.getElementById('send-message-button');
            const messagesDisplayArea = document.getElementById('messages-display-area');

            // Update header title specifically for chat detail
            headerTitle.textContent = currentChatRoomName;

            // Initialize chatMessages for the current room if not already done
            if (!chatMessages[currentChatRoomId]) {
                chatMessages[currentChatRoomId] = [...(mockMessages[currentChatRoomId] || [])];
            }
            
            const renderCurrentRoomMessages = () => {
                const msgs = chatMessages[currentChatRoomId] || [];
                if (messagesDisplayArea) {
                    if (msgs.length === 0) {
                        messagesDisplayArea.innerHTML = `<div class="text-center text-gray-500 p-4 font-inter">No messages yet. Be the first to say hello!</div>`;
                    } else {
                        messagesDisplayArea.innerHTML = msgs.map(msg => `
                            <div class="flex ${msg.senderId === currentUserId ? 'justify-end' : 'justify-start'}">
                                <div class="max-w-[75%] p-3 rounded-lg shadow-sm font-inter
                                    ${msg.senderId === currentUserId
                                        ? 'bg-purple-600 text-white rounded-br-none'
                                        : 'bg-white text-gray-800 rounded-bl-none border border-gray-200'
                                    }"
                                >
                                    <p class="text-xs text-gray-300 mb-1 font-semibold">${msg.senderId === currentUserId ? 'You' : `User ${msg.senderId.substring(0, 8)}...`}</p>
                                    <p class="text-sm break-words">${msg.text}</p>
                                    <span class="block text-right text-xs mt-1 opacity-75">
                                        ${new Date(msg.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                                    </span>
                                </div>
                            </div>
                        `).join('');
                        messagesDisplayArea.scrollTop = messagesDisplayArea.scrollHeight; // Scroll to bottom
                    }
                }
            };

            renderCurrentRoomMessages(); // Initial render of messages for the room

            const localSendMessage = () => {
                const messageText = messageInput.value.trim();
                if (messageText) {
                    const newMsg = { senderId: currentUserId, text: messageText, timestamp: Date.now() };
                    chatMessages[currentChatRoomId].push(newMsg);
                    messageInput.value = ''; // Clear input field
                    renderCurrentRoomMessages(); // Re-render messages
                }
            };

            if (messageInput) {
                messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') localSendMessage();
                });
            }
            if (sendMessageButton) {
                sendMessageButton.addEventListener('click', localSendMessage);
            }
        };

        const renderProfilePage = () => {
            updateHeader();
            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Your Profile</h2>
                    <p class="text-gray-600 mb-6 font-inter">Manage your account and listings.</p>
                    <div class="bg-white p-6 rounded-xl shadow-lg max-w-md mx-auto">
                        <img
                          src="https://placehold.co/100x100/A78BFA/FFFFFF?text=JP"
                          alt="User Avatar"
                          class="rounded-full mx-auto mb-4 border-4 border-purple-200 shadow-md"
                          onerror="this.onerror=null;this.src='https://placehold.co/100x100/A78BFA/FFFFFF?text=Error';"
                        />
                        <p class="text-xl font-semibold text-gray-800 font-inter">Hello, Local User!</p>
                        <p class="text-gray-500 mb-4 font-inter">Member since 2024</p>
                        <button id="edit-profile-button" class="bg-purple-100 text-purple-700 font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 hover:bg-purple-200 shadow-md">
                            Edit Profile
                        </button>
                        <button id="my-listings-button" class="mt-3 bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 transform hover:scale-105 shadow-md">
                            My Listings
                        </button>
                        <div class="mt-4 text-left space-y-2">
                            <p class="text-gray-600 font-inter"><span class="font-semibold">Listings:</span> ${userListings.length} active</p>
                            <p class="text-gray-600 font-inter"><span class="font-semibold">Orders:</span> 2 completed</p>
                            <p class="text-gray-600 font-inter"><span class="font-semibold">Rating:</span> 4.8/5.0</p>
                        </div>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            document.getElementById('my-listings-button').addEventListener('click', () => handleNavigate('myListings'));
        };

        const renderMyListingsPage = () => {
            updateHeader();
            let html = `
                <div class="p-4">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter text-center">My Listings</h2>
                    <p class="text-gray-600 mb-6 font-inter text-center">View and manage your active listings.</p>
                    <div id="my-listings-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- User listings will be rendered here -->
                    </div>
                    ${userListings.length === 0 ? '<p class="text-gray-500 font-inter text-center mt-8 col-span-full">You have no active listings. Go to "Sell" to add one!</p>' : ''}
                </div>
            `;
            appContent.innerHTML = html;

            const myListingsContainer = document.getElementById('my-listings-container');
            if (myListingsContainer) {
                myListingsContainer.innerHTML = userListings.map(listing => `
                    <div class="bg-white rounded-xl shadow-md overflow-hidden text-left">
                        <img
                            src="${listing.imageUrl}"
                            alt="${listing.name}"
                            class="w-full h-40 object-cover"
                            onerror="this.onerror=null;this.src='https://placehold.co/300x200/e0e0e0/555555?text=Image+Error';"
                        />
                        <div class="p-4">
                            <h4 class="text-lg font-semibold text-gray-800 mb-1 font-inter">${listing.name}</h4>
                            <p class="text-sm text-gray-600 mb-2 font-inter flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-tag mr-1 text-purple-500"><path d="M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414L12.586 22.414a2 2 0 0 0 2.828 0l7.172-7.172a2 2 0 0 0 0-2.828z"/><circle cx="7.5" cy="7.5" r=".5" fill="currentColor"/></svg>
                                ${listing.category}
                            </p>
                            <p class="text-md font-bold text-purple-700 font-inter flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-euro mr-1"><path d="M4 10h12"/><path d="M4 14h9"/><path d="M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 4.5-2"/></svg>
                                ${typeof listing.price === 'number' ? `MYR ${listing.price.toFixed(2)}` : listing.price}
                            </p>
                            <div class="mt-4 flex space-x-2">
                                <button class="edit-listing-button bg-blue-500 hover:bg-blue-600 text-white text-sm font-bold py-2 px-3 rounded-lg flex-1" data-id="${listing.id}">
                                    Edit
                                </button>
                                <button class="delete-listing-button bg-red-500 hover:bg-red-600 text-white text-sm font-bold py-2 px-3 rounded-lg flex-1" data-id="${listing.id}">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');

                myListingsContainer.querySelectorAll('.edit-listing-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const listingId = e.currentTarget.dataset.id;
                        editingListing = userListings.find(item => item.id === listingId);
                        if (editingListing) {
                            handleNavigate('editListing');
                        }
                    });
                });

                myListingsContainer.querySelectorAll('.delete-listing-button').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const listingId = e.currentTarget.dataset.id;
                        if (confirm('Are you sure you want to delete this listing?')) { // Using confirm for simplicity
                            userListings = userListings.filter(item => item.id !== listingId);
                            renderPage(currentPage); // Re-render the current page to update list
                            renderProductCards(getCombinedAndFilteredProducts()); // Update homepage too
                        }
                    });
                });
            }
        };

        const renderEditListingPage = () => {
            updateHeader();
            if (!editingListing) {
                appContent.innerHTML = `<div class="text-center text-gray-500 p-8 font-inter">No listing selected for editing.</div>`;
                return;
            }

            let html = `
                <div class="p-4 text-center">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 font-inter">Edit Listing</h2>
                    <p class="text-gray-600 mb-6 font-inter">Modify the details of your item.</p>
                    <div class="bg-white p-6 rounded-xl shadow-lg max-w-md mx-auto">
                        <div class="mb-4">
                            <label for="edit-title" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Title</label>
                            <input type="text" id="edit-title" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" value="${editingListing.name}" />
                        </div>
                        <div class="mb-4">
                            <label for="edit-description" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Description</label>
                            <textarea id="edit-description" rows="3" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">${editingListing.description}</textarea>
                        </div>
                        <div class="mb-4">
                            <label for="edit-category" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Category</label>
                            <select id="edit-category" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">
                                ${allCategories.filter(cat => cat !== 'All').map(cat => `<option value="${cat}" ${cat === editingListing.category ? 'selected' : ''}>${cat}</option>`).join('')}
                            </select>
                        </div>
                        <div class="mb-4">
                            <label for="edit-price" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Price (MYR)</label>
                            <input type="number" id="edit-price" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" value="${typeof editingListing.price === 'number' ? editingListing.price : ''}" />
                        </div>
                        <div class="mb-4">
                            <label for="edit-image-url" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Image URL (Optional)</label>
                            <input type="text" id="edit-image-url" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" value="${editingListing.imageUrl}" />
                        </div>
                        <div class="mb-4">
                            <label for="edit-location" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Location</label>
                            <input type="text" id="edit-location" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" value="${editingListing.location}" />
                        </div>
                        <!-- New: Pickup/Delivery Options -->
                        <div class="mb-4">
                            <label for="edit-delivery-options" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Pickup/Delivery Options</label>
                            <select id="edit-delivery-options" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="N/A" ${editingListing.deliveryOptions === 'N/A' ? 'selected' : ''}>N/A</option>
                                <option value="Pickup Only" ${editingListing.deliveryOptions === 'Pickup Only' ? 'selected' : ''}>Pickup Only</option>
                                <option value="Delivery Available" ${editingListing.deliveryOptions === 'Delivery Available' ? 'selected' : ''}>Delivery Available</option>
                                <option value="Both Pickup & Delivery" ${editingListing.deliveryOptions === 'Both Pickup & Delivery' ? 'selected' : ''}>Both Pickup & Delivery</option>
                            </select>
                        </div>
                        <!-- New: Operating Hours -->
                        <div class="mb-4">
                            <label for="edit-hours" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Operating Hours (e.g., Mon-Fri: 9 AM - 5 PM)</label>
                            <input type="text" id="edit-hours" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500" value="${editingListing.hours}" />
                        </div>
                        <!-- New: Shop Status -->
                        <div class="mb-6">
                            <label for="edit-shop-status" class="block text-left text-gray-700 text-sm font-bold mb-2 font-inter">Shop Status</label>
                            <select id="edit-shop-status" class="shadow appearance-none border rounded-lg w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-purple-500">
                                <option value="N/A" ${editingListing.shopStatus === 'N/A' ? 'selected' : ''}>N/A</option>
                                <option value="Open" ${editingListing.shopStatus === 'Open' ? 'selected' : ''}>Open</option>
                                <option value="Closed" ${editingListing.shopStatus === 'Closed' ? 'selected' : ''}>Closed</option>
                                <option value="Closing Soon" ${editingListing.shopStatus === 'Closing Soon' ? 'selected' : ''}>Closing Soon</option>
                            </select>
                        </div>
                        <button id="save-changes-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 transform hover:scale-105 shadow-md">
                            Save Changes
                        </button>
                        <button id="cancel-edit-button" class="mt-3 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 w-full font-inter transition-all duration-200 shadow-md">
                            Cancel
                        </button>
                        <p id="edit-message" class="text-green-600 text-sm mt-3 hidden"></p>
                    </div>
                </div>
            `;
            appContent.innerHTML = html;

            const saveChangesButton = document.getElementById('save-changes-button');
            const cancelEditButton = document.getElementById('cancel-edit-button');
            const editMessage = document.getElementById('edit-message');

            if (saveChangesButton) {
                saveChangesButton.addEventListener('click', () => {
                    const title = document.getElementById('edit-title').value;
                    const description = document.getElementById('edit-description').value;
                    const category = document.getElementById('edit-category').value;
                    const priceInput = document.getElementById('edit-price').value;
                    const price = category === 'Jobs' ? priceInput : parseFloat(priceInput); // Handle price as string for jobs
                    const imageUrl = document.getElementById('edit-image-url').value;
                    const location = document.getElementById('edit-location').value;
                    const deliveryOptions = document.getElementById('edit-delivery-options').value;
                    const hours = document.getElementById('edit-hours').value;
                    const shopStatus = document.getElementById('edit-shop-status').value;

                    // Basic validation for non-job categories requiring numeric price
                    if (category !== 'Jobs' && isNaN(price)) {
                        editMessage.textContent = 'Please enter a valid numeric price for this category.';
                        editMessage.classList.remove('hidden', 'text-green-600');
                        editMessage.classList.add('text-red-600');
                        return;
                    }

                    if (title && description && category && location) {
                        const index = userListings.findIndex(item => item.id === editingListing.id);
                        if (index !== -1) {
                            userListings[index] = {
                                ...userListings[index],
                                name: title,
                                description: description,
                                category: category,
                                price: price,
                                imageUrl: imageUrl || `https://placehold.co/300x200/cccccc/333333?text=${encodeURIComponent(title.substring(0,10))}`,
                                location: location,
                                deliveryOptions: deliveryOptions,
                                hours: hours,
                                shopStatus: shopStatus
                            };
                            editMessage.textContent = 'Listing updated successfully!';
                            editMessage.classList.remove('hidden', 'text-red-600');
                            editMessage.classList.add('text-green-600');

                            setTimeout(() => {
                                handleNavigate('myListings');
                            }, 1500);
                        }
                    } else {
                        editMessage.textContent = 'Please fill in all required fields.';
                        editMessage.classList.remove('hidden', 'text-green-600');
                        editMessage.classList.add('text-red-600');
                    }
                });
            }

            if (cancelEditButton) {
                cancelEditButton.addEventListener('click', () => {
                    handleNavigate('myListings');
                });
            }
        };

        const renderPage = (page) => {
            switch (page) {
                case 'home':
                    renderHomePage();
                    break;
                case 'categories':
                    renderCategoriesPage();
                    break;
                case 'sell':
                    renderSellPage();
                    break;
                case 'chat':
                    renderChatRoomsPage();
                    break;
                case 'chatDetail':
                    renderChatRoomDetail();
                    break;
                case 'productDetail':
                    renderProductDetailPage();
                    break;
                case 'profile':
                    renderProfilePage();
                    break;
                case 'myListings':
                    renderMyListingsPage();
                    break;
                case 'editListing':
                    renderEditListingPage();
                    break;
                default:
                    renderHomePage();
                    break;
            }
        };

        // --- Event Listeners for Navigation ---
        navButtons.home.addEventListener('click', () => handleNavigate('home'));
        navButtons.categories.addEventListener('click', () => handleNavigate('categories'));
        navButtons.sell.addEventListener('click', () => handleNavigate('sell'));
        navButtons.chat.addEventListener('click', () => handleNavigate('chat'));
        navButtons.profile.addEventListener('click', () => handleNavigate('profile'));

        // --- Initialize App ---
        document.addEventListener('DOMContentLoaded', () => {
            renderPage(currentPage);
            updateNavActiveState(currentPage);
        });

    </script>
</body>
</html>
